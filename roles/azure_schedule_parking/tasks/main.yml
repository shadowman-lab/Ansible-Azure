---
- name: Build the Schedule for Stopping Azure instances for {{ environment }}
  ansible.controller.schedule:
    name: Park Azure instances for {{ environment }}
    state: present
    unified_job_template: AzureParking-Stop
    rrule: "{{ query('ansible.controller.schedule_rrule', frequency, start_date=stop_date_time,timezone='GMT',every=repetition | int) }}"
    extra_data:
      newowner: "{{ owner }}"
      newenvironment: "{{ environment }}"
    validate_certs: false
    controller_username: "{{ lookup('env', 'TOWER_USERNAME') }}"
    controller_password: "{{ lookup('env', 'TOWER_PASSWORD') }}"
    controller_host: "{{ lookup('env', 'TOWER_HOST') }}"

- name: Build the Schedule for Starting Azure instances for {{ environment }}
  ansible.controller.schedule:
    name: UnPark Azure instances for {{ environment }}
    state: present
    unified_job_template: AzureParking-Start
    rrule: "{{ query('ansible.controller.schedule_rrule', frequency, start_date=stop_date_time,timezone='GMT',every=repetition | int) }}"
    extra_data:
      owner: "{{ owner }}"
      environment: "{{ environment }}"
    validate_certs: false
    controller_username: "{{ lookup('env', 'TOWER_USERNAME') }}"
    controller_password: "{{ lookup('env', 'TOWER_PASSWORD') }}"
    controller_host: "{{ lookup('env', 'TOWER_HOST') }}"
